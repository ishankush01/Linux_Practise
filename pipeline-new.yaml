trigger: none
parameters:
  - name: AgentPool
    displayName: Select Agent pool
    type: string
    values:
      - Linux_Self_Hosted_Agent
  - name: 'Test Agent'
    displayName: Select Test Agent
    type: string
    values:
      - Linux_Self_Hosted_Agent
      - ishan-test-vm-windows
      - ishan-test-vm-w
      - ishan-test-vm-windows1

  - name: AvilableSoftware
    displayName: Select Avilable Software with version
    type: string
    default: none
    values:
        - none
        - git-2.27.0
        - git-2.45.0
        - git-2.46.0
        - helm-3.10.2
        - helm-3.11.0
        - helm-3.16.0
        - git-lfs-2.10.0
        - maven-3.6.3
        - maven-3.8.6
        - maven-3.9.6
        - apache-maven-3.8.8
        - apache-maven-3.9.9
        - python-3.10.12
        - python-3.12.5
        - python-3.12.7
        - python-3.11.4
        - python-3.11.9
        - python-3.13.0
        - jdk-11.0.22
        - jdk-11.0.23
        - jdk-17.0.12
        - jdk-21.0.4
        - apache-ant-1.10.14
        - apache-ant-1.10.15
        - gradle-7.5.1
        - gradle-8.10
        - bicep-0.29.47
        - bicep-0.30.23
        - bicep-0.30.3
        - dotnet-6.0.425
        - dotnet-6.0.427
        - dotnet-8.0.402
        - powershell-7.2.23
        - powershell-7.4.5
        - node-21.7.3
        - node-22.9.0
        - chrome-0.0.1
        - firefox-0.0.1
        - azure-cli-2.65.0
        - azure-cli-2.64.0
        - mysql-8.0.40
        - tabulareditor-3.17.1
        - tabulareditor-2.20.2
        - kubectl-1.31.2
        
  - name: SoftwareName
    displayName: Software Name
    type: string
    default: none
    values:
        - none
        - git
        - helm
        - python
        - git-lfs
        - maven
        - python
        - jdk
        - ant
        - gradle
        - bicep
        - dotnet
        - pwsh
        - node
        - chrome
        - firefox
        - azure-cli
        - mysql
        - tabulareditor
        - kubectl

  - name: SoftwareVersion
    displayName: Software Version
    type: string
    default: none
    values:
        - none
        - 2.27.0
        - 2.45.0
        - 2.46.0
        - 3.10.2
        - 3.11.0
        - 3.16.0
        - 2.10.0
        - 3.6.3
        - 3.8.8
        - 3.9.9
        - 3.10.12
        - 3.12.5
        - 3.12.7
        - 3.11.4
        - 3.11.9
        - 3.13.0
        - 11.0.22
        - 11.0.23
        - 1.8.0_391
        - 11.0.12
        - 17.0.12
        - 21.0.4
        - 1.10.14
        - 1.10.15
        - 7.5.1
        - 8.10
        - 0.29.47
        - 0.30.23
        - 0.30.3
        - 6.0.425
        - 6.0.427
        - 8.0.402
        - 7.2.23
        - 7.4.5
        - 21.7.3
        - 22.9.0
        - 2.65.0
        - 2.64.0
        - 0.0.1
        - 8.0.40
        - 3.17.1
        - 2.20.2
        - 1.31.2

  - name: artifactoryURL
    type: string
    default: https://trialx4qamp.jfrog.io/artifactory

stages:
  - stage: InstallSoftware
    displayName: Install Software
    pool:
      name: ${{ parameters.AgentPool }}
      demands:
            - ${{ if eq(parameters.AgentPool, 'Test Agent') }}:
                - Agent.ComputerName -equals ${{ parameters['Test Agent'] }}
    jobs:
      - job: InstallSoftware
        workspace:
          clean: all
        steps:
          - task: Bash@3
            displayName: Install ${{ parameters.SoftwareName }} on Linux
            condition: eq(variables['Agent.OS'], 'Linux')
            inputs:
              targetType: inline
              script: |
                  set -ax
                  if [ -d "/opt/cicd-tools/${{ parameters.SoftwareName }}/${{ parameters.SoftwareVersion }}" ]; then
                    sudo rm -rf /opt/cicd-tools/${{ parameters.SoftwareName }}/${{ parameters.SoftwareVersion }}
                  fi
                  echo "#============#"
                  echo "# Install software  #"
                  echo "#==============#"
                  sudo mkdir -p /opt/cicd-tools/${{ parameters.SoftwareName }}/${{ parameters.SoftwareVersion }}
                  # sudo chown -R adocicdrsvc:azr_pas_p_ADO_CICD_Devops /opt/cicd-tools/${{ parameters.SoftwareName }}/${{ parameters.SoftwareVersion }}
                  cd /opt/cicd-tools/${{ parameters.SoftwareName }}/${{ parameters.SoftwareVersion }}
                  sudo curl -u email:xxxxx -O ${{ parameters.artifactoryURL }}/ishankey-local-test/${{ parameters.SoftwareName }}/linux/${{ parameters.AvilableSoftware }}.tar.gz #>> /dev/null 2>&1
                  echo downloading ${{ parameters.AvilableSoftware }}
                  ls -lart
                  sudo tar -zxf ${{ parameters.AvilableSoftware }}.tar.gz
                  #sudo tar -zxf ${{ parameters.AvilableSoftware }}.tar
                  ls -lart
                  sudo rm -rf ${{ parameters.AvilableSoftware }}.tar.gz
                  ls -lart
                  pwd
                  echo "#=====================#"
                  echo "# Verify software version.  #"
                  echo "#=====================#"
                  # Update PATH to prioritize the new version
                  #export PATH=/opt/cicd-tools/${{ parameters.SoftwareName }}/${{ parameters.SoftwareVersion }}/bin:$PATH
                  # Get the software name from the parameter
                  # Set the software name from the pipeline parameters
                  Software="${{ parameters.SoftwareName }}"
                  hostname

                  # Determine the correct version command based on the software
                  case "$Software" in
                      java)
                          # Java uses `-version` and captures only the first line
                          version=$(java -version 2>&1 | head -n 1)
                          ;;
                      
                      maven)
                          # Maven uses `-v`
                          export M2_HOME=/opt/cicd-tools/${{ parameters.SoftwareName }}/${{ parameters.SoftwareVersion }}/${{ parameters.AvilableSoftware }}
                          export PATH=$M2_HOME/bin:$PATH
                          version=$(mvn -v 2>&1)
                          ;;
                      
                      # python3)
                      #     # Python 3 uses `--version`
                      #     version=$(python3 --version 2>&1)
                      #     ;;
                      
                      python)
                          # Python 2 uses `--version`
                          version=$(python3 --version 2>&1)
                          ;;
                      
                      helm)
                          # Optionally move the helm binary if needed
                          sudo mv /opt/cicd-tools/helm/3.10.2/helm /usr/local/bin &> /dev/null
                          chmod +x helm
                          # Helm uses `version --short`
                          version=$(helm version --short 2>&1)
                          ;;
                      
                      kubectl)
                          # kubectl uses `version --client --short`
                          version=$(kubectl version --client --short 2>&1)
                          ;;
                      
                      git)
                          # Git uses `--version`
                          sudo yum groupinstall "Development Tools" -y
                          sudo yum remove git -y
                          cd ${{ parameters.AvilableSoftware }}
                          sudo make prefix=/usr/local all install
                          git --version
                          ;;
                      
                      git-lfs)
                          # Git-lfs uses `--version`
                          version=$(git lfs --version 2>&1)
                          ;;

                      apache-ant)
                          # apache-ant uses `--version`
                          if [ -d "/usr/local/ant" ]; then
                              echo "Removing old ant version at /usr/local/ant"
                              sudo rm -rf /usr/local/ant
                          fi 
                          sudo mv ${{ parameters.AvilableSoftware }} /usr/local/ant/
                          export ANT_HOME=/usr/local/ant
                          echo $ANT_HOME
                          export PATH=$ANT_HOME/bin:$PATH
                          echo 'export PATH=$ANT_HOME/bin:$PATH'
                          version=$(ant -version 2>&1)
                          ;;

                      gradle)
                          #gradle uses `--version`
                          export GRADLE_HOME=/opt/cicd-tools/${{ parameters.SoftwareName }}/${{ parameters.SoftwareVersion }}/${{ parameters.AvilableSoftware }}-bin/${{ parameters.AvilableSoftware }}
                          echo $GRADLE_HOME
                          export PATH=$PATH:$GRADLE_HOME/bin
                          echo 'export PATH=$PATH:$GRADLE_HOME/bin' >> ~/.bashrc
                          source ~/.bashrc
                          echo $PATH
                          version=$(gradle -version 2>&1)
                          gradle --version;
                          ;;
                      bicep)
                          # bicep `--version`
                          sudo mv ${{ parameters.AvilableSoftware }} /usr/local/bin/bicep
                          sudo chmod +x /usr/local/bin/bicep
                          version=$(bicep --version 2>&1)
                          ;;
                      node)
                          # node `-v`
                          
                          version=$(node -v 2>&1)
                          ;;
                      dotnet)
                          # Dotnet uses `--version`
                          cd ..
                          sudo rm -rf ${{ parameters.SoftwareVersion }}
                          sudo curl -u email:xxxx -O ${{ parameters.artifactoryURL }}/ishankey-local-test/${{ parameters.SoftwareName }}/linux/${{ parameters.AvilableSoftware }}.tar.gz #>> /dev/null 2>&1
                          echo downloading ${{ parameters.AvilableSoftware }}
                          ls -lart
                          if [ -d "/usr/local/share/dotnet" ]; then
                              echo "Removing old .NET version at /usr/local/share/dotnet"
                              sudo rm -rf /usr/local/share/dotnet
                          fi
                          sudo mkdir -p /usr/local/share/dotnet  
                          sudo tar -zxf ${{ parameters.AvilableSoftware }}.tar.gz -C /usr/local/share/dotnet
                          sudo rm -rf ${{ parameters.AvilableSoftware }}.tar.gz
                          export DOTNET_ROOT=/usr/local/share/dotnet
                          export PATH=$PATH:/usr/local/share/dotnet
                          version=$(dotnet --version 2>&1)
                          ;;
                      jdk)
                          # java `-version`
                          cd ..
                          sudo rm -rf ${{ parameters.SoftwareVersion }}
                          sudo curl -u email:xxxx -O ${{ parameters.artifactoryURL }}/ishankey-local-test/${{ parameters.SoftwareName }}/linux/${{ parameters.AvilableSoftware }}.tar.gz 
                          if [ -d "/usr/local/java" ]; then
                              echo "Removing old java version at /usr/local/java"
                              sudo rm -rf /usr/local/java
                          fi
                          sudo mkdir -p /usr/local/java
                          sudo tar -xvzf ${{ parameters.AvilableSoftware }}.tar.gz -C /usr/local/java
                          sudo rm -rf ${{ parameters.AvilableSoftware }}.tar.gz
                          if grep -q "export JAVA_HOME=" /etc/profile; then
                              echo "Removing existing JAVA_HOME entry from /etc/profile..."
                              sudo sed -i '/export JAVA_HOME=/d' /etc/profile
                          fi
                          if grep -q "export PATH=.*\$JAVA_HOME/bin" /etc/profile; then
                              echo "Removing existing PATH entry related to JAVA_HOME from /etc/profile..."
                              sudo sed -i '/export PATH=.*JAVA_HOME\/bin/d' /etc/profile
                          fi
                          # Add the new JDK version
                          if ! grep -q "export JAVA_HOME=/usr/local/java/${{ parameters.AvilableSoftware }}" /etc/profile; then
                              echo "Setting new JAVA_HOME and PATH for JDK version ${{ parameters.AvilableSoftware }}..."
                              echo "export JAVA_HOME=/usr/local/java/${{ parameters.AvilableSoftware }}" | sudo tee -a /etc/profile
                              echo 'export PATH=$PATH:$JAVA_HOME/bin' | sudo tee -a /etc/profile
                          fi
                          # Apply changes
                          source /etc/profile
                          source ~/.bashrc
                          version=$(java -version 2>&1)
                          ;;

                      pwsh)
                          # PowerShell uses `--version`
                          cd ..
                          sudo rm -rf ${{ parameters.SoftwareVersion }}
                          sudo curl -u email:xxxx -O ${{ parameters.artifactoryURL }}/ishankey-local-test/${{ parameters.SoftwareName }}/linux/${{ parameters.AvilableSoftware }}.tar.gz #>> /dev/null 2>&1
                          echo downloading ${{ parameters.AvilableSoftware }}
                          ls -lart
                          sudo mkdir -p /opt/microsoft/powershell/7
                          sudo tar -zxf ${{ parameters.AvilableSoftware }}.tar.gz -C /opt/microsoft/powershell/7
                          sudo rm -rf ${{ parameters.AvilableSoftware }}.tar.gz
                          ls -lart
                          sudo chmod +x /opt/microsoft/powershell/7/pwsh
                          if [ -L /usr/bin/pwsh ] || [ -e /usr/bin/pwsh ]; then
                              sudo rm -f /usr/bin/pwsh
                          fi
                          sudo ln -s /opt/microsoft/powershell/7/pwsh /usr/bin/pwsh
                          version=$(pwsh --version 2>&1)
                          ;;
                      *)
                          echo "Unknown software: $Software"
                          exit 1
                          ;;
                  esac
                  
                  echo "$Software version: $version"
                      
                      echo ""  # Add an empty line between sections
                  #done
                  
          - task: PowerShell@2
            displayName: Install ${{ parameters.SoftwareName }} on Windows
            condition: eq(variables['Agent.OS'], 'Windows_NT')
            inputs:
                targetType: inline
                script: |
                    $ErrorActionPreference = "Stop"
                    $Software = "${{ parameters.SoftwareName }}"
                    $AvailableSoftware = "${{ parameters.AvilableSoftware }}"
                    $SoftwareVersion = "${{ parameters.SoftwareVersion }}"
                    $artifactoryURL = "${{ parameters.artifactoryURL }}"
                    $SoftwareDir = "C:\cicd-tools\${{ parameters.SoftwareName }}\$SoftwareVersion"
                    if (Test-Path $SoftwareDir) {
                      Write-Host "Removing existing ${{ parameters.SoftwareName }} directory..."
                      Remove-Item -Recurse -Force $SoftwareDir
                    }
                    New-Item -ItemType Directory -Path $SoftwareDir -Force | Out-Null
                    
                    $username = 'xxxxxxxxx'
                    $password = 'xxxxxxxxx'
                    $secPassword = ConvertTo-SecureString $password -AsPlainText -Force
                    $credObject = New-Object System.Management.Automation.PSCredential ($username, $secPassword)
                    
                    switch ($Software) {
                        "git" {
                            $currentPath = [System.Environment]::GetEnvironmentVariable("PATH", [System.EnvironmentVariableTarget]::Machine)
                            $gitPattern = "C:\cicd-tools\git\*"
                            $pathList = $currentPath.Split(';')
                            $newPathList = $pathList | Where-Object { $_ -notlike $gitPattern }
                            $newPath = [string]::Join(';', $newPathList)

                            [System.Environment]::SetEnvironmentVariable("PATH", $newPath, [System.EnvironmentVariableTarget]::Machine)
                            Write-Host "Old Git paths removed from PATH."

                            Invoke-WebRequest -Uri "${artifactoryURL}/cicd-pipeline-generic-local/$Software/windows/$AvailableSoftware/Git.exe" -OutFile "$SoftwareDir\git.exe" -Credential $credObject
                            Start-Process -FilePath "$SoftwareDir\git.exe" -ArgumentList "/VERYSILENT", "/SUPPRESSMSGBOXES", "/NORESTART", "/DIR=$gitPath" -Wait

                            $gitVersion = & "$SoftwareDir\git.exe" --version 2>&1
                            Write-Host "Git version: $gitVersion"

                            if ($newPath -notlike "*$SoftwareDir\cmd*") {
                                [System.Environment]::SetEnvironmentVariable("PATH", "$newPath;$SoftwareDir\cmd", [System.EnvironmentVariableTarget]::User)
                                Write-Host "Updated PATH environment variable with: $SoftwareDir\cmd"
                            } else {
                                Write-Host "Git path already exists in the PATH environment variable."
                            }
                        }
                        "helm" {
                            $currentPath = [System.Environment]::GetEnvironmentVariable("PATH", [System.EnvironmentVariableTarget]::Machine)
                            $helmPattern = "C:\cicd-tools\helm\*"
                            $pathList = $currentPath.Split(';')
                            $newPathList = $pathList | Where-Object { $_ -notlike $helmPattern }
                            $newPath = [string]::Join(';', $newPathList)

                            [System.Environment]::SetEnvironmentVariable("PATH", $newPath, [System.EnvironmentVariableTarget]::Machine)
                            Write-Host "Old Helm paths removed from PATH."

                            Invoke-WebRequest -Uri "${artifactoryURL}/cicd-pipeline-generic-local/$Software/windows/$AvailableSoftware/helm.exe" -OutFile "$SoftwareDir\helm.exe" -Credential $credObject

                            # Append the new helmPath to the PATH environment variable if not already present
                            if ($newPath -notlike "*$SoftwareDir*") {
                                [System.Environment]::SetEnvironmentVariable("PATH", "$newPath;$SoftwareDir", [System.EnvironmentVariableTarget]::Machine)
                                Write-Host "Updated PATH environment variable with: $SoftwareDir"
                            } else {
                                Write-Host "Helm path already exists in the PATH environment variable."
                            }

                            $helmVersion = & "$SoftwareDir\helm.exe" version --short 2>&1
                            Write-Host "Helm version: $helmVersion"
                        }
                        "node" {
                            $currentPath = [System.Environment]::GetEnvironmentVariable("PATH", [System.EnvironmentVariableTarget]::Machine)
                            $nodePattern = "C:\cicd-tools\node\*"
                            $pathList = $currentPath.Split(';')
                            $newPathList = $pathList | Where-Object { $_ -notlike $nodePattern }
                            $newPath = [string]::Join(';', $newPathList)

                            [System.Environment]::SetEnvironmentVariable("PATH", $newPath, [System.EnvironmentVariableTarget]::Machine)
                            Write-Host "Old Node.js paths removed from PATH."

                            Invoke-WebRequest -Uri "${artifactoryURL}/cicd-pipeline-generic-local/$Software/windows/$AvailableSoftware.zip" -OutFile "$SoftwareDir\node.zip" -Credential $credObject

                            Add-Type -AssemblyName System.IO.Compression.FileSystem

                            [System.IO.Compression.ZipFile]::ExtractToDirectory("$SoftwareDir\node.zip", $SoftwareDir)
                            $extractedFolders = Get-ChildItem -Path $SoftwareDir -Directory
                            if ($extractedFolders.Count -eq 1) {
                                $subfolder = $extractedFolders.FullName
                                Write-Host "Moving content from subfolder: $subfolder"
                                Move-Item "$subfolder\*" $SoftwareDir -Force
                                Remove-Item -Recurse -Force $subfolder
                            } elseif ($extractedFolders.Count -eq 0) {
                                Write-Error "No subfolder or files were extracted!"
                                exit 1
                            }

                            if (-not (Test-Path "$SoftwareDir\node.exe")) {
                                Write-Error "Node.js installation failed: node.exe not found!"
                                exit 1
                            }
                            if ($newPath -notlike "*$SoftwareDir*") {
                                [System.Environment]::SetEnvironmentVariable("PATH", "$newPath;$SoftwareDir", [System.EnvironmentVariableTarget]::Machine)
                                Write-Host "Updated PATH environment variable with: $SoftwareDir"
                            } else {
                                Write-Host "Node.js path already exists in the PATH environment variable."
                            }
                            $nodeVersion = & "$SoftwareDir\node.exe" --version 2>&1
                            Write-Host "Node.js version: $nodeVersion"
                        }
                        "bicep" {
                            $currentPath = [System.Environment]::GetEnvironmentVariable("PATH", [System.EnvironmentVariableTarget]::Machine)
                            $bicepPattern = "C:\cicd-tools\bicep\*"
                            $pathList = $currentPath.Split(';')
                            $newPathList = $pathList | Where-Object { $_ -notlike $bicepPattern }
                            $newPath = [string]::Join(';', $newPathList)

                            [System.Environment]::SetEnvironmentVariable("PATH", $newPath, [System.EnvironmentVariableTarget]::Machine)

                            Invoke-WebRequest -Uri "${artifactoryURL}/cicd-pipeline-generic-local/$Software/windows/$AvailableSoftware.exe" -OutFile "$SoftwareDir\bicep.exe" -Credential $credObject

                            if (-not (Test-Path "$SoftwareDir\bicep.exe")) {
                                Write-Error "Bicep installation failed: bicep.exe not found!"
                                exit 1
                            }

                            if ($newPath -notlike "*$SoftwareDir*") {
                                [System.Environment]::SetEnvironmentVariable("PATH", "$newPath;$SoftwareDir", [System.EnvironmentVariableTarget]::Machine)
                                Write-Host "Updated PATH environment variable with: $SoftwareDir"
                            } else {
                                Write-Host "Bicep path already exists in the PATH environment variable."
                            }
                        }
                        "jdk" {
                            $currentPath = [System.Environment]::GetEnvironmentVariable("PATH", [System.EnvironmentVariableTarget]::Machine)
                            $javaPattern = "C:\cicd-tools\jdk\*"
                            $pathList = $currentPath.Split(';')
                            $newPathList = $pathList | Where-Object { $_ -notlike $javaPattern }
                            $newPath = [string]::Join(';', $newPathList)

                            [System.Environment]::SetEnvironmentVariable("PATH", $newPath, [System.EnvironmentVariableTarget]::Machine)

                            $outFile = Join-Path $SoftwareDir "$AvailableSoftware.zip"
                            Invoke-WebRequest -Uri "${artifactoryURL}/cicd-pipeline-generic-local/$Software/windows/$AvailableSoftware.zip" -OutFile "$outFile" -Credential $credObject
                            Write-Host "Extracting JDK ZIP to: $SoftwareDir"

                            Expand-Archive -LiteralPath $outFile -DestinationPath $SoftwareDir -Force
                            Remove-Item $outFile

                            if (-Not (Test-Path "$SoftwareDir\$AvailableSoftware\bin\java.exe")) {
                                Write-Host "Extraction failed. Ensure the ZIP file contains the JDK binaries."
                                exit 1
                            }
                            $java_path = Join-Path $SoftwareDir "$AvailableSoftware"

                            Write-Host "Setting JAVA_HOME to: $SoftwareDir"
                            [System.Environment]::SetEnvironmentVariable('JAVA_HOME_21_X64', $java_path, [System.EnvironmentVariableTarget]::Machine)

                            $binPath = Join-Path $java_path "bin"

                            $currentPath = [System.Environment]::GetEnvironmentVariable("Path", [System.EnvironmentVariableTarget]::Machine)
                            if ($currentPath -notlike "*$binPath*") {
                                Write-Host "Adding JDK bin to system PATH"
                                [System.Environment]::SetEnvironmentVariable("Path", "$newPath;$java_path;$binPath", [System.EnvironmentVariableTarget]::Machine)
                            } else {
                                Write-Host "JDK bin is already in the system PATH"
                            }
                            # Verify the installation
                            Write-Host "Verifying Java installation..."
                            try {
                                java -version
                            } catch {
                                Write-Host "Java is not installed correctly. Please check the environment variables and paths."
                            }
                        }
                        "maven" {
                            $currentPath = [System.Environment]::GetEnvironmentVariable("PATH", [System.EnvironmentVariableTarget]::Machine)
                            $mavenPattern = "C:\cicd-tools\maven\*"
                            $pathList = $currentPath.Split(';')
                            $newPathList = $pathList | Where-Object { $_ -notlike $mavenPattern }
                            $newPath = [string]::Join(';', $newPathList)
                            [System.Environment]::SetEnvironmentVariable("PATH", $newPath, [System.EnvironmentVariableTarget]::Machine)
                            
                            $outFile = Join-Path $SoftwareDir "$AvailableSoftware.zip"
                            Invoke-WebRequest -Uri "${artifactoryURL}/cicd-pipeline-generic-local/$Software/windows/$AvailableSoftware.zip" -OutFile "$outFile" -Credential $credObject
                            Write-Host "Extracting maven ZIP to: $outFile"
                            Expand-Archive -LiteralPath $outFile -DestinationPath $SoftwareDir -Force
                            Remove-Item $outFile
                            if (-Not (Test-Path "$SoftwareDir\$AvailableSoftware\bin\mvn.cmd")) {
                                Write-Host "Extraction failed. Ensure the ZIP file contains the Maven binaries."
                                exit 1
                            }

                            # Set M2_HOME environment variable
                            $maven_path = Join-Path $SoftwareDir "$AvailableSoftware"
                            Write-Host "Setting M2_HOME to: $maven_path"
                            [System.Environment]::SetEnvironmentVariable('M2_HOME', $maven_path, [System.EnvironmentVariableTarget]::Machine)
                            $binPath = Join-Path $maven_path "bin"
                            $currentPath = [System.Environment]::GetEnvironmentVariable("Path", [System.EnvironmentVariableTarget]::Machine)
                            if ($currentPath -notlike "*$binPath*") {
                                Write-Host "Adding Maven bin to system PATH"
                                [System.Environment]::SetEnvironmentVariable("Path", "$newPath;$maven_path;$binPath", [System.EnvironmentVariableTarget]::Machine)
                            } else {
                                Write-Host "Maven bin is already in the system PATH"
                            }
                            Write-Host "Maven is install Successfully..."
                        }
                        "python" {
                            $currentPath = [System.Environment]::GetEnvironmentVariable("PATH", [System.EnvironmentVariableTarget]::Machine)
                            $pythonPattern = "C:\cicd-tools\python\*"
                            $pathList = $currentPath.Split(';')
                            $newPathList = $pathList | Where-Object { $_ -notlike $pythonPattern }
                            $newPath = [string]::Join(';', $newPathList)
                            [System.Environment]::SetEnvironmentVariable("PATH", $newPath, [System.EnvironmentVariableTarget]::Machine)

                            $outFile = Join-Path $SoftwareDir "$AvailableSoftware.zip"
                            Invoke-WebRequest -Uri "${artifactoryURL}/cicd-pipeline-generic-local/$Software/windows/$AvailableSoftware.zip" -OutFile "$outFile" -Credential $credObject
                            Write-Host "Extracting Python embeddable package to: $SoftwareDir"
                            Expand-Archive -Path $outFile -DestinationPath $SoftwareDir -Force

                            # Set PYTHON_HOME environment variable
                            Write-Host "Setting PYTHON_HOME to: $SoftwareDir"
                            [System.Environment]::SetEnvironmentVariable('PYTHON_HOME', $SoftwareDir, [System.EnvironmentVariableTarget]::Machine)
                            $binPath = Join-Path $SoftwareDir "python.exe"
                            $currentPath = [System.Environment]::GetEnvironmentVariable("Path", [System.EnvironmentVariableTarget]::Machine)

                            if ($currentPath -notlike "*$SoftwareDir*") {
                                Write-Host "Adding Python to system PATH"
                                [System.Environment]::SetEnvironmentVariable("Path", "$currentPath;$binPath;$SoftwareDir", [System.EnvironmentVariableTarget]::Machine)
                            } else {
                                Write-Host "Python is already in the system PATH"
                            }

                            # Verify the installation
                            Write-Host "Verifying Python installation..."
                            try {
                                python --version
                            } catch {
                                Write-Host "Python is not installed correctly. Please check the environment variables and paths."
                            }
                            # Clean up downloaded ZIP file
                            Remove-Item $outFile -Force
                            Write-Host "Python installation and configuration via embeddable package completed."
                        }
                        "ant" {
                            $currentPath = [System.Environment]::GetEnvironmentVariable("PATH", [System.EnvironmentVariableTarget]::Machine)
                            $antPattern = "C:\cicd-tools\ant\*"
                            $pathList = $currentPath.Split(';')
                            $newPathList = $pathList | Where-Object { $_ -notlike $antPattern }
                            $newPath = [string]::Join(';', $newPathList)
                            [System.Environment]::SetEnvironmentVariable("PATH", $newPath, [System.EnvironmentVariableTarget]::Machine)

                            $outFile = Join-Path $SoftwareDir "$AvailableSoftware.zip"
                            Invoke-WebRequest -Uri "${artifactoryURL}/cicd-pipeline-generic-local/$Software/windows/$AvailableSoftware.zip" -OutFile "$outFile" -Credential $credObject
                            Write-Host "Download Ant file to: $outFile"
                            Expand-Archive -Path $outFile -DestinationPath $SoftwareDir
                            Remove-Item $outFile

                            $ant_path = Join-Path $SoftwareDir "$AvailableSoftware"
                            [System.Environment]::SetEnvironmentVariable('ANT_HOME', $ant_path, [System.EnvironmentVariableTarget]::Machine)
                            # Add Ant to system PATH
                            $binPath = Join-Path $ant_path "bin"
                            $currentPath = [System.Environment]::GetEnvironmentVariable("Path", [System.EnvironmentVariableTarget]::Machine)
                            if ($currentPath -notlike "*$binPath*") {
                                Write-Host "Adding Ant bin to system PATH"
                                [System.Environment]::SetEnvironmentVariable("Path", "$currentPath;$ant_path;$binPath", [System.EnvironmentVariableTarget]::Machine)
                            } else {
                                Write-Host "Ant bin is already in the system PATH"
                            }
                            Write-Host "ant is install Successfully..."
                        }
                        "dotnet" {
                            $currentPath = [System.Environment]::GetEnvironmentVariable("PATH", [System.EnvironmentVariableTarget]::Machine)
                            $dotnetPattern = "C:\cicd-tools\dotnet\*"
                            $pathList = $currentPath.Split(';')
                            $newPathList = $pathList | Where-Object { $_ -notlike $dotnetPattern }
                            $newPath = [string]::Join(';', $newPathList)
                            [System.Environment]::SetEnvironmentVariable("PATH", $newPath, [System.EnvironmentVariableTarget]::Machine)

                            # Download .NET SDK ZIP package
                            $outFile = Join-Path $SoftwareDir "$AvailableSoftware.zip"
                            Invoke-WebRequest -Uri "${artifactoryURL}/cicd-pipeline-generic-local/$Software/windows/$AvailableSoftware.zip" -OutFile "$outFile" -Credential $credObject
                            Write-Host "Download dotnet file to: $outFile"

                            # Extract .NET SDK ZIP package
                            Write-Host "Extracting .NET SDK ZIP to: $SoftwareDir"
                            Expand-Archive -Path $outFile -DestinationPath $SoftwareDir -Force
                            Remove-Item $outFile -Force

                            # Set DOTNET_HOME environment variable (optional)
                            Write-Host "Setting DOTNET_HOME to: $SoftwareDir"
                            [System.Environment]::SetEnvironmentVariable('DOTNET_HOME', $SoftwareDir, [System.EnvironmentVariableTarget]::Machine)
                            $currentPath = [System.Environment]::GetEnvironmentVariable("Path", [System.EnvironmentVariableTarget]::Machine)
                            [System.Environment]::SetEnvironmentVariable("Path", "$currentPath;$SoftwareDir", [System.EnvironmentVariableTarget]::Machine)

                            # Verify the installation
                            Write-Host "Verifying .NET SDK installation..."
                            try {
                                dotnet --version
                            } catch {
                                Write-Host ".NET SDK is not installed correctly. Please check the environment variables and paths."
                            }
                            Write-Host ".NET SDK installation and configuration completed."
                        }
                        "chrome" {
                            $outFile = Join-Path $SoftwareDir "chrome_installer.exe"
                            Invoke-WebRequest -Uri "${artifactoryURL}/cicd-pipeline-generic-local/$Software/windows/$AvailableSoftware.exe" -OutFile "$outFile" -Credential $credObject
                            Write-Host "Download dotnet file to: $outFile"
                            Write-Host "Installing Google Chrome silently..."
                            Start-Process -FilePath $outFile -ArgumentList "/silent", "/install" -Wait

                            # Verify installation
                            $chromePath = "C:\Program Files\Google\Chrome\Application\chrome.exe"
                            if (Test-Path $chromePath) {
                                Write-Host "Google Chrome installation completed successfully!"
                                # Optionally, you can also check Chrome's version
                                $chromeVersion = (Get-Item $chromePath).VersionInfo.ProductVersion
                                Write-Host "Installed Chrome version: $chromeVersion"
                            } else {
                                Write-Host "Google Chrome installation failed."
                                exit 1
                            }
                            Write-Host "Google Chrome installation completed."
                        }

                        "firefox" {
                            $outFile = Join-Path $SoftwareDir "firefox.exe"
                            Invoke-WebRequest -Uri "${artifactoryURL}/cicd-pipeline-generic-local/$Software/windows/$AvailableSoftware.exe" -OutFile "$outFile" -Credential $credObject
                            Write-Host "Download dotnet file to: $outFile"

                            # Install Firefox silently
                            Write-Host "Installing Firefox silently..."
                            Start-Process -FilePath "$outFile" -ArgumentList "/S" -Wait

                            # Wait for the installation to complete
                            Write-Host "Waiting for the installation to complete..."
                            Start-Sleep -Seconds 35
                            Write-Host "Firefox installation completed successfully."
                        }
                        "azure-cli" {
                            $currentPath = [System.Environment]::GetEnvironmentVariable("PATH", [System.EnvironmentVariableTarget]::Machine)
                            $azureCliPattern = "C:\cicd-tools\azure-cli\*"
                            $pathList = $currentPath.Split(';')
                            $newPathList = $pathList | Where-Object { $_ -notlike $azureCliPattern }
                            $newPath = [string]::Join(';', $newPathList)
                            [System.Environment]::SetEnvironmentVariable("PATH", $newPath, [System.EnvironmentVariableTarget]::Machine)

                            $outFile = Join-Path $SoftwareDir "$AvailableSoftware.zip"
                            Invoke-WebRequest -Uri "${artifactoryURL}/cicd-pipeline-generic-local/$Software/windows/$AvailableSoftware.zip" -OutFile "$outFile" -Credential $credObject
                            Write-Host "Download azure-cli file to: $outFile"
                            Expand-Archive -Path $outFile -DestinationPath $SoftwareDir
                            Remove-Item $outFile

                            # Add azure-cli to system PATH
                            $binPath = Join-Path $SoftwareDir "bin"
                            $currentPath = [System.Environment]::GetEnvironmentVariable("Path", [System.EnvironmentVariableTarget]::Machine)
                            if ($currentPath -notlike "*$binPath*") {
                                Write-Host "Adding azure-cli bin to system PATH"
                                [System.Environment]::SetEnvironmentVariable("Path", "$currentPath;$SoftwareDir;$binPath", [System.EnvironmentVariableTarget]::Machine)
                            } else {
                                Write-Host "azure-cli bin is already in the system PATH"
                            }
                            Write-Host "azure-cli is install Successfully..."
                        }
                        "tabularEditor" {
                            # Enable TLS 1.2 for secure download
                            Write-Host "Setting TLS1.2..."
                            [Net.ServicePointManager]::SecurityProtocol = [Net.ServicePointManager]::SecurityProtocol -bor "Tls12"

                            $currentPath = [System.Environment]::GetEnvironmentVariable("PATH", [System.EnvironmentVariableTarget]::Machine)
                            $tabularEditorPattern = "C:\cicd-tools\tabularEditor\*"
                            $pathList = $currentPath.Split(';')
                            $newPathList = $pathList | Where-Object { $_ -notlike $tabularEditorPattern }
                            $newPath = [string]::Join(';', $newPathList)
                            [System.Environment]::SetEnvironmentVariable("PATH", $newPath, [System.EnvironmentVariableTarget]::Machine)

                            $outFile = Join-Path $SoftwareDir "$AvailableSoftware.zip"
                            Invoke-WebRequest -Uri "${artifactoryURL}/cicd-pipeline-generic-local/$Software/windows/$AvailableSoftware.zip" -OutFile "$outFile" -Credential $credObject
                            Write-Host "Download tabularEditor file to: $outFile" -Force
                            Expand-Archive -Path $outFile -DestinationPath $SoftwareDir
                            Remove-Item $outFile

                            [System.Environment]::SetEnvironmentVariable("PATH", "$newPath;$SoftwareDir", [System.EnvironmentVariableTarget]::Machine)
                            # Verify installation by checking for TabularEditor.exe
                            $tabularEditorPath = "$SoftwareDir\TabularEditor.exe"
                            if (Test-Path $tabularEditorPath) {
                                Write-Host "Tabular Editor installed successfully."
                            } else {
                                Write-Host "Tabular Editor installation failed."
                                exit 1
                            }
                        }
                        "mysql" {
                            # Define variables
                            $mysqlInstallerURL = "${artifactoryURL}/cicd-pipeline-generic-local/$Software/windows/$AvailableSoftware.msi"
                            $outFile = Join-Path $SoftwareDir "mysql-installer.msi"
                            $logFile = Join-Path $SoftwareDir "install.log"

                            # Ensure the directory is clean
                            if (Test-Path $SoftwareDir) {
                                Remove-Item -Recurse -Force $SoftwareDir
                                Write-Host "Removing existing MySQL directory..."
                            }
                            New-Item -Path $SoftwareDir -ItemType Directory | Out-Null

                            # Download MySQL installer
                            Invoke-WebRequest -Uri $mysqlInstallerURL -OutFile $outFile -Credential $credObject
                            Write-Host "Downloaded MySQL installer to: $outFile"

                            # Install MySQL using msiexec directly
                            try {
                                # Using msiexec directly in PowerShell
                                $msiExecCmd = "msiexec /i `"$outFile`" /qn /lv `"$logFile`" INSTALLDIR=`"$SoftwareDir`""
                                Write-Host "Running command: $msiExecCmd"
                                iex $msiExecCmd  # Executes the msiexec command
                                Write-Host "MySQL installation completed. Log saved at: $logFile"
                            } catch {
                                Write-Host "MySQL installation failed. Please check the installer, paths, and log file."
                                exit 1
                            }

                            # Verify installation
                            $mysqlExePath = Join-Path $SoftwareDir "bin\mysql.exe"
                            if (Test-Path $mysqlExePath) {
                                Write-Host "MySQL installed successfully. Verifying version..."
                                & "$mysqlExePath" --version
                            } else {
                                Write-Host "MySQL installation failed. Check the MSI installer and environment."
                                exit 1
                            }

                            # Adding MySQL bin to PATH if not already added
                            $currentPath = [System.Environment]::GetEnvironmentVariable("PATH", [System.EnvironmentVariableTarget]::Machine)
                            $binPath = Join-Path $SoftwareDir "bin"
                            if ($currentPath -notlike "*$binPath*") {
                                [System.Environment]::SetEnvironmentVariable("PATH", "$currentPath;$binPath", [System.EnvironmentVariableTarget]::Machine)
                                Write-Host "MySQL bin path added to system PATH"
                            } else {
                                Write-Host "MySQL bin path already exists in the system PATH."
                            }
                        }
                        "kubectl" {
                            $currentPath = [System.Environment]::GetEnvironmentVariable("PATH", [System.EnvironmentVariableTarget]::Machine)
                            $kubectlPattern = "C:\cicd-tools\kubectl\*"
                            $pathList = $currentPath.Split(';')
                            $newPathList = $pathList | Where-Object { $_ -notlike $kubectlPattern }
                            $newPath = [string]::Join(';', $newPathList)

                            # Remove old kubectl paths from PATH
                            [System.Environment]::SetEnvironmentVariable("PATH", $newPath, [System.EnvironmentVariableTarget]::Machine)
                            Write-Host "Old kubectl paths removed from PATH."
                            Invoke-WebRequest -Uri "${artifactoryURL}/cicd-pipeline-generic-local/$Software/windows/$AvailableSoftware.exe" -OutFile $outFile -Credential $credObject
                            [System.Environment]::SetEnvironmentVariable("Path", "$newPath;$SoftwareDir", [System.EnvironmentVariableTarget]::Machine)
                            Write-Host "Verifying kubectl installation..."
                            try {
                                kubectl version --client
                            } catch {
                                Write-Host "kubectl is not installed correctly. Please check the environment variables and paths."
                                exit 1
                            }
                            Write-Host "kubectl installed successfully!"
                        }
                    }